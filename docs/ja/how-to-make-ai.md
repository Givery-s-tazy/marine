# AI Challengeの作り方
## 概要
AIチャレンジとは

- 大容量データを扱う
- 膨大な計算機リソースを使用する

など、オンラインエディタ上で問題を解くことに不向きなプログラミング問題の総称です。
主に機械学習を使用する問題が作成されています。

## 受験者がAIチャレンジでできること
AIチャレンジの受験において、受験者ができることは以下の3つだけです。

- ブラウザ上で問題文(README.md)を読む
- 問題を解くために必要なデータファイルをダウンロードする
  - このファイルは数百MBからGB単位の大きさになることがあります。
- 問題の指定する形式での解答ファイルをアップロードする

解答ファイルはJSONやCSVなど、出題者が指定したフォーマットとなります。
解答ファイルはアップロード毎に採点されます。

通常、祭典後にはその得点が受験者に開示されますが、track.ymlで`hideRawScore: true`となっている場合は得点に対応するランク(S, A, B, C, D, Eの6段階)が表示されます。

## 出題者がAIチャレンジ作成時にすべきこと
逆にAIチャレンジの出題者が問題作成のためにすることは以下になります。

- 問題内容をREADME.mdを書く
- 問題を解くために必要なデータファイルを用意し、tar.gzまたはzip形式で圧縮してpublicにダウンロードできるインターネット上の任意の場所に配置する
- 採点を行うジャッジアプリケーションを作成する。
  - 巨大なデータファイルが必要な場合などサイズが大きくなる場合は、tar.gz形式で圧縮してpublicにダウンロードできるインターネット上の任意の場所に配置しても良い。

コーディングチャレンジではチャレンジ作成に必要なすべてのファイルはgit(GitHub)で管理しますが、AIチャレンジでは扱うファイルサイズが巨大になることが想定されるため、外部のストレージでの管理としています。

(publicストレージに置かれたファイルはチャレンジ作成/更新時にのみ使用されます。track側にチャレンジを取り込む際にはそれらのファイルはtrackのprivateストレージにコピーされるので受験者がそれらのpublicストレージに直接アクセスすることはありません。)

## ジャッジアプリケーションの仕様
ジャッジアプリケーションはtrackのテスト実行環境のDocker上で実行されます。
trackがサポートする言語であれば、どんな言語でジャッジアプリケーションを作成しても構いません。

ユーザがアップロードしたファイルのファイル名は環境変数`UPLOAD_FILENAME`から取得できます。
ジャッジアプリケーションがすべきことはユーザがアップロードしたファイルを読み込んでそのファイルを採点し、得点(任意の数値)を標準出力に出力することです。
その数値がそのまま、AIチャレンジの得点になります。

入力ファイルになんらかの不備がある場合はわかりやすい表現でエラーメッセージを標準エラー出力に出力してください。
ここで出力されたエラーメッセージはそのまま受験者に表示されます。

## scoreType
AIチャレンジではジャッジアプリケーションが得点を任意の数値として出力しますが、その数値がどういう意味を持っているかはわかりません。
例えば機械学習の分野だけでも、正解率、再現率、適合率などの様々な評価指標が存在します。

これらの数値は0〜1の範囲で分布している場合もあれば、0から無限大、あるいはマイナス値が使われることもあります。
また、優劣に関しても数値が大きい方が優秀とは限らず、数値が小さい方が高得点であったり、絶対値で0に近い方が高得点というケースもあります。

これらの数値の順位付けを定義したものが`scoreType`です。
`scoreType`はtrack.ymlで`rankBy`, `max`, `min`という3つのキーを使って定義します。

- rankBy: 必須。数値の優劣の比較方法を定義する。`high`, `low`, `zero`のいずれか。
  - high: 数値の大きい方が優位
  - low:  数値の小さい方が優位
  - zero: 絶対値で0に小さい方が優位
- max: 任意。スコアとして現れる数値の上限値を定義する。省略時は上限なし
- min: 任意。スコアとして現れる数値の下限値を定義する。省略時は下限なし

```
# スコアは0〜1の範囲で数値が大きい方がハイスコア
scoreType:
  rankBy: high
  max: 1
  min: 0
```

## rankedRange
AIチャレンジのスコアは百分率で表せるとは限らないので、どれくらいの得点をとればどれくらいのランクであるかを示す指標を定義するのが`rankedRange`です。

S, A, B, C, D, Eのそれぞれのランクに対応する得点範囲を定義します。

```
rankedRange:
  S: 0.80..
  A: 0.75..0.80
  B: 0.65..0.75
  C: 0.50..0.65
  D: 0.40..0.50
  E: ..0.40
```

上の例の場合、ユーザの得点が、

- 0.80以上の場合はSランク
- 0.75以上、0.80未満の場合はAランク
- 0.65以上、0.80未満の場合はBランク
- 0.50以上、0.80未満の場合はCランク
- 0.40以上、0.80未満の場合はDランク
- 0.40未満の場合はEランク

となります。

ランク定義の数値範囲が重複する場合は、先にマッチしたランクが有効となります。

## track.yml
AIチャレンジの定義にもtrack.ymlを使用します。
コーディングチャレンジと共通の部分もありますが、AIチャレンジで使用するキーは以下になります。

- type: string. 必須. 
  - AIチャレンジの場合は`AI`固定です
- readonly: Array<string>
  - ユーザーにダウンロードさせるデータファイルのURLを指定します。
  - ファイルの形式はtar.gzまたはzipです。
- hide: Array<string>
  - ジャッジアプリケーション(またはそのソース・ファイル)を含むファイルを指定します。
  - ファイルは複数指定可能です。
  - ファイルへのパスの代わりにインターネット上に配置されたtar.gzファイルのURLを指定することも可能です。
- images: Array<string>
  - README.mdから参照する画像ファイルを指定します。ワイルドカードが使用できます。
  - ここで指定されたファイルはREADME.mdから相対パスで参照できます。
- test: string. 必須
  - ジャッジアプリケーションの実行コマンドを指定します
- build: Array<string>
  - ジャッジアプリケーションをソースコードからbuildする場合はそのbuildコマンドを指定します。
- envConf: hash
  - ジャッジアプリケーションを実行するDockerコンテナの情報を指定します。
  - 省略時はNodeJSのDockerイメージが使用されます。
  - imageName: string. テストで使用するdockerイメージ名を指定します
  - workingDir: string. dockerイメージ内で使用するカレントディレクトリのパスを指定します。(省略時は`/root/src`になります)
  - cacheDirs: Array<string>. Webエディタ実行中にテスト実行サーバでキャッシュするディレクトリを指定します。(Ruby, Javaのライブラリキャッシュ等)
- scoreType: hash
  - 上述のスコアの順序付けに関する情報を指定します。
  - 省略時は rankBy=High, 上限下限なしとなります。
- hideRawScore: boolean
  - trueの場合、受験者に正確な得点は開示されず代わりにrankedRangeで定義されたランクが表示されます。

未知のキーは無視されます。

例
```
type: AI
test: node test.js
images:
  - images/nue.jpg
readonly:
  - https://www.example.com/ai-challenge-1/data.tar.gz
hide:
  - https://www.example.com/ai-challenge-1/judge.tar.gz
scoreType:
  rankBy: high
  min: 0
  max: 1
```

## README.md
README.mdには問題の内容をマークダウンで記述します。
フォーマットは任意ですが、オフィシャル問題の場合はある程度テンプレート化されているのでテンプレートに従って記述するようにしてください。

マークダウンの記述ではいくつかの[拡張機能](markdown-extension.md)が使用できます。

README.mdはtrack.ymlに含める必要はありません。

## 国際化対応
trackではチャレンジのコンパイル時にオプションとして言語(ja, en)を指定します。

このオプションによってREADMEを取り込む時のファイル選択のロジックが変わります。

- `ja` -> `README_ja.md`があればそれを使用、なければ`README.md`を使用
- `en` -> `README_en.md`があればそれを使用、なければ`README.md`を使用

国際化する問題の場合は日本語と英語の両方のREADMEを用意することが望まれます。

言語オプションはジャッジアプリケーションからは環境変数`CHALLENGE_LANGUAGE`で参照できます。

この環境変数を利用すればジャッジアプリケーション内でエラーメッセージを切り替えることも可能になります。
